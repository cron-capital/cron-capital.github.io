<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron Capital Portfolio</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .header-top {
            margin-bottom: 20px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .last-update {
            color: #666;
            font-size: 14px;
            text-align: right;
        }

        .exchange-rate {
            color: #666;
            font-size: 13px;
            text-align: right;
            margin-top: 5px;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-width: 600px;
        }

        .summary-item {
            background: #333;
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .summary-item label {
            display: block;
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-item .value {
            font-size: 24px;
            font-weight: bold;
            text-align: right;
        }

        .stocks-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        .stock-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e0e0e0;
            cursor: pointer;
        }

        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stock-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stock-symbol {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .profit-badge {
            font-size: 13px;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 12px;
            white-space: nowrap;
        }

        .profit-badge.profit {
            background: #d4edda;
            color: #155724;
        }

        .profit-badge.loss {
            background: #f8d7da;
            color: #721c24;
        }

        .stock-exchange {
            background: #333;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .stock-info {
            display: grid;
            gap: 12px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .loading {
            text-align: center;
            color: #333;
            font-size: 20px;
            padding: 50px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .inline-icon {
            width: 1em;          /* í…ìŠ¤íŠ¸ í¬ê¸°ì— ë§ì¶¤ */
            height: 1em;
            vertical-align: -0.125em;  /* ìˆ˜ì§ ì •ë ¬ ë¯¸ì„¸ ì¡°ì • */
            margin-right: 0.2em;       /* í…ìŠ¤íŠ¸ì™€ ê°„ê²© */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <h1>
                    <img src="/favicon.svg" alt="" class="inline-icon"> Cron Capital
                </h1>
                <div>
                    <div class="last-update">Last Updated: <span id="lastUpdate">Loading...</span></div>
                    <div class="exchange-rate"><span id="exchangeRate">Loading...</span></div>
                </div>
            </div>
            <div class="summary" id="summary"></div>
        </div>
        <div class="stocks-grid" id="stocksGrid"></div>
    </div>

    <script>
        // ë°ëª¨ ë°ì´í„° (í•˜ë“œì½”ë”©)
        const demoData = {
            stocks: {
                TQQQ: {
                    symbol: 'TQQQ',
                    excg: 'NASD',
                    qty: 4,
                    avg_price: 54.4597,
                    now_price: 58.00
                },
                SOXL: {
                    symbol: 'SOXL',
                    excg: 'AMEX',
                    qty: 3,
                    avg_price: 60.8433,
                    now_price: 58.00
                }
            },
            total_value: 678.69,
            exchange_rate: 1469.7
        };

        async function getLastUpdateTime() {
            try {
                const response = await fetch('https://api.github.com/repos/cron-capital/cron-capital.github.io/commits?path=portfolio.json&page=1&per_page=1');
                if (!response.ok) throw new Error('Failed to fetch');
                
                const commits = await response.json();
                if (commits && commits.length > 0) {
                    const lastCommitDate = new Date(commits[0].commit.committer.date);
                    return formatDate(lastCommitDate);
                }
            } catch (error) {
                console.log('GitHub API í˜¸ì¶œ ì‹¤íŒ¨, í˜„ì¬ ì‹œê°„ ì‚¬ìš©');
            }
            return formatDate(new Date());
        }

        function formatDate(date) {
            // UTC to KST (UTC+9)
            const kstDate = new Date(date.getTime() + (9 * 60 * 60 * 1000));
            const year = kstDate.getUTCFullYear();
            const month = String(kstDate.getUTCMonth() + 1).padStart(2, '0');
            const day = String(kstDate.getUTCDate()).padStart(2, '0');
            const hours = String(kstDate.getUTCHours()).padStart(2, '0');
            const minutes = String(kstDate.getUTCMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes} ğŸ‡°ğŸ‡·`;
        }

        async function loadPortfolioData() {
            try {
                const response = await fetch('portfolio.json');
                if (!response.ok) throw new Error('íŒŒì¼ ì—†ìŒ');
                const data = await response.json();
                displayPortfolio(data);
            } catch (error) {
                console.log('portfolio.json íŒŒì¼ì´ ì—†ì–´ ë°ëª¨ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤');
                displayPortfolio(demoData);
            }
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
            const lastUpdate = await getLastUpdateTime();
            document.getElementById('lastUpdate').textContent = lastUpdate;
        }

        function displayPortfolio(data) {
            displaySummary(data);
            displayStocks(data.stocks, data.exchange_rate);
        }

        function displaySummary(data) {
            // ì˜ˆìˆ˜ê¸ˆ ê³„ì‚°
            let availableCash = data.total_value;
            for (const stock of Object.values(data.stocks)) {
                availableCash -= stock.qty * stock.now_price;
            }

            // í™˜ìœ¨ í‘œì‹œ
            document.getElementById('exchangeRate').textContent = `ğŸ‡ºğŸ‡¸ $1 : ğŸ‡°ğŸ‡· â‚©${data.exchange_rate.toFixed(1)}`;

            document.getElementById('summary').innerHTML = `
                <div class="summary-item">
                    <label>Total Assets</label>
                    <div class="value">$${data.total_value.toFixed(2)}</div>
                </div>
                <div class="summary-item">
                    <label>Available Cash</label>
                    <div class="value">$${availableCash.toFixed(2)}</div>
                </div>
            `;
        }

        function displayStocks(stocks, exchangeRate) {
            const stocksGrid = document.getElementById('stocksGrid');
            stocksGrid.innerHTML = '';

            for (const [symbol, stock] of Object.entries(stocks)) {
                const totalValue = stock.qty * stock.now_price;
                const totalCost = stock.qty * stock.avg_price;
                const profitLoss = totalValue - totalCost;
                const profitLossPercent = ((profitLoss / totalCost) * 100);
                const isProfitable = profitLoss >= 0;

                const card = document.createElement('div');
                card.className = 'stock-card';
                card.onclick = () => {
                    window.open(`https://www.google.com/search?q=${stock.symbol}+stock`, '_blank');
                };
                card.innerHTML = `
                    <div class="stock-header">
                        <div class="stock-title">
                            <div class="stock-symbol">${stock.symbol}</div>
                            <div class="stock-exchange">${stock.excg}</div>
                        </div>
                        <div class="profit-badge ${isProfitable ? 'profit' : 'loss'}">
                            ${isProfitable ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${isProfitable ? '+' : ''}${profitLossPercent.toFixed(2)}%
                        </div>
                    </div>
                    <div class="stock-info">
                        <div class="info-row">
                            <span class="info-label">Quantity</span>
                            <span class="info-value">${stock.qty}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Avg Price</span>
                            <span class="info-value">${stock.avg_price.toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Current Price</span>
                            <span class="info-value">${stock.now_price.toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Cost</span>
                            <span class="info-value">${totalCost.toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Market Value</span>
                            <span class="info-value">${totalValue.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                stocksGrid.appendChild(card);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        loadPortfolioData();

        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(loadPortfolioData, 5 * 60 * 1000);
    </script>
</body>
</html>
